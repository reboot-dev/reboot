syntax = "proto3";

package rbt.v1alpha1.admin;

import "google/protobuf/struct.proto";

////////////////////////////////////////////////////////////////////////

message ListServersRequest {}
message ListServersResponse {
  repeated string server_ids = 1;
}

message ExportRequest {
  string server_id = 1;
}

message ExportImportItem {
  string state_type = 1;
  string state_ref = 2;
  oneof item {
    google.protobuf.Struct state = 3;
    bytes sorted_map_entry = 4;
    google.protobuf.Struct task = 5;
    google.protobuf.Struct idempotent_mutation = 6;
  }
}

message ImportResponse {}

////////////////////////////////////////////////////////////////////////

service ExportImport {
  rpc ListServers(ListServersRequest) returns (ListServersResponse);
  rpc Export(ExportRequest) returns (stream ExportImportItem);
  rpc Import(stream ExportImportItem) returns (ImportResponse);
}

////////////////////////////////////////////////////////////////////////
